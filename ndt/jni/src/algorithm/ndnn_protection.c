/*************************************************
* NDT DNN PROTECTION
* Copyright(c) 2018, NewDegreeTechnology, Inc.
**************************************************/


#include "algorithm_init.h"

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

ST_OUT_LIER st_outlier;

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

s32 lspTemp3[SIG_DIM]; //¡Ÿ ±æÿ’Û1

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

u8 ndnn_protection_detect(void)
{
    u8 i;

    for (i = 0; i < SIG_DIM; i++)
    {
        lspTemp3[i] = st_fv.force_val[i];
        lspTemp3[i] <<= 10;
        lspTemp3[i] = lspTemp3[i] / st_fv.max_force[0];
    }

    return calc_outlier_matrix(lspTemp3);
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

void ndnn_protection_proc(void)
{
    if (1 == st_tf.tri_cnt[0])
    {
        if (0 == ndnn_protection_detect())
        {
            st_tf.sub_flag[0] = 0;
            st_tf.all_flag &= 0xfe;
            st_tf.rel_cnt[0] = 100;
        }
    }
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

